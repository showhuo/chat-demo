(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{308:function(e,t,r){e.exports=r(697)},313:function(e,t,r){},695:function(e,t,r){},697:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(9),c=r.n(o);r(313),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(314);var s=r(287);function u(e,t){var r=document.getElementsByTagName("html")[0],n=document.body.clientWidth||document.documentElement.clientWidth;r.style.fontSize=n/e*t+"px"}window.onload=function(){u(1920,100)},window.onresize=Object(s.throttle)(function(){u(1920,100)},100);var i,m=r(156),l=r(707),h=r(704),p=r(706),d=r(703),f=r(99),g=r(100),v=r(103),b=r(101),C=r(104),y=r(61),O=r(57),j=r(30),w=r(290),E=function(e){return{type:"create_user",meta:{user:e}}},I=function(e,t,r,n){return{type:"send_message",meta:{from:e,currentChat:t,msg:r,img:n}}},M=function(e,t,r){return{type:"retract_message",meta:{from:e,currentChat:t,msgIdx:r}}},k=function(e,t){return{type:"switch_chat",meta:{user:e,chat:t}}},N=function(e,t){return{type:"create_group",meta:{inviter:e,invitee:t}}},T=function(e,t,r){return{type:"invite_to_group",meta:{inviter:e,invitees:t,group:r}}},_=function(e){return{type:"sync_state",meta:{newState:e}}},S=function(e,t){return{type:"move_chat_to_top",meta:{user:e,currentChat:t}}},G=r.n(w)()((i={},Object(O.a)(i,"send_message",function(e,t){var r=t.meta,n=r.from,a=r.currentChat,o=r.msg,c=r.img;return e.updateIn(["chats",a],function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.a)()).push(Object(j.b)({name:n,msg:o,img:c}))})}),Object(O.a)(i,"switch_chat",function(e,t){var r=t.meta,n=r.user,a=r.chat,o=a.includes("group"),c=a;o||(c=n.localeCompare(a)<0?"".concat(n,"-").concat(a):"".concat(a,"-").concat(n));var s=e;return e.getIn(["chats",c])||(s=s.setIn(["chats",c],Object(j.a)())),s.setIn([n,"currentChat"],c)}),Object(O.a)(i,"create_group",function(e,t){var r=t.meta,n=r.inviter,a=r.invitee,o="group".concat(e.get("groupNum")+1);return e.updateIn(["groupNum"],function(e){return e+1}).updateIn([n,"friends"],function(e){return e.unshift(o)}).updateIn([a,"friends"],function(e){return e.unshift(o)}).setIn(["chats",o],Object(j.a)([{name:"root",msg:"".concat(n," invites ").concat(a," into the group.")}])).set(o,Object(j.a)([n,a]))}),Object(O.a)(i,"invite_to_group",function(e,t){var r=t.meta,n=r.inviter,a=r.invitees,o=r.group,c=e;return a.forEach(function(e){c=c.updateIn([e,"friends"],function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.a)()).unshift(o)})}),c.update(o,function(e){return e.concat(a)}).updateIn(["chats",o],function(e){return e.push(Object(j.b)({name:"root",msg:"".concat(n," invites ").concat(a," into the group.")}))})}),Object(O.a)(i,"retract_message",function(e,t){var r=t.meta,n=r.from,a=r.currentChat,o=r.msgIdx;return e.updateIn(["chats",a],function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.a)()).splice(o,1,Object(j.b)({name:"root",msg:"".concat(n," retracts a message.")}))})}),Object(O.a)(i,"sync_state",function(e,t){var r=t.meta.newState;return Object(j.d)(r)}),Object(O.a)(i,"move_chat_to_top",function(e,t){var r=t.meta,n=r.user,a=r.currentChat,o=e,c=null;if(a.includes("group")){var s=a;c=s,e.get(s).forEach(function(e){o=B(o,e,s)})}else c=a.split("-").find(function(e){return e!==n}),o=B(o,c,n);return o=B(o,n,c)}),i),Object(j.d)({userNum:2,groupNum:1,user1:{friends:["user2","user3","user4","user5","group1"],currentChat:"user1-user2"},user2:{friends:["user1","user3","user4","user5","group1"],currentChat:"user1-user2"},user3:{friends:["user1","user2","user4","user5"],currentChat:""},user4:{friends:["user1","user2","user3","user5"],currentChat:""},user5:{friends:["user1","user2","user3","user4"],currentChat:""},group1:["user1","user2"],chats:{"user1-user2":[{name:"user1",msg:"hello, i am user1"},{name:"user2",msg:"hello, i am user2"}],group1:[{name:"user1",msg:"hello, i am user1"},{name:"user2",msg:"hello, i am user2"}]},allPeople:["user1","user2","user3","user4","user5"]}));function B(e,t,r){var n=e.getIn([t,"friends"]).findIndex(function(e){return e===r});return-1!==n?e.updateIn([t,"friends"],function(e){return e.delete(n).unshift(r)}):e}var x=r(291),J=r.n(x);r(699);var W=r(301),F=(r(133),r(37)),A=(r(526),r(303)),D=(r(528),r(211)),R=function(e){function t(){var e,r;Object(f.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(r=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(o)))).state={showFriendsModal:!1,friendsWillBeInvited:[]},r.createMsgRow=function(e){var t=e.name,n=e.msg,o=e.img,c=e.key,s=r.props,u=s.retractMsg,i=s.currentChat,m=s.user,l=s.broadcast,h=Object(O.a)({root:"root-msg"},m,"my-msg"),p=n;return o&&(p=a.a.createElement("img",{src:o,alt:"",className:"chat-img"})),a.a.createElement("div",{className:"msg-row ".concat(h[t]||"other-msg"),key:c,onMouseDown:function(e){0===e.button&&t===m&&D.a.confirm({title:"Retract your message ?",onOk:function(){u(m,i,c),l()}})}},t===m?"me":t,": ",p)},r.createModal=function(){var e=r.props,t=e.friends,n=e.currentChat,o=e.groupMember;if(n.includes("group")){var c=new j.c(o),s=t.toJS().filter(function(e){return!e.includes("group")&&!c.has(e)}).map(function(e){return{label:e,value:e}});return a.a.createElement(D.a,{title:"Add group member",visible:r.state.showFriendsModal,onOk:r.handleOk,onCancel:r.handleCancel,maskClosable:!1},a.a.createElement(A.a.Group,{options:s,onChange:function(e){r.setState({friendsWillBeInvited:e})}}))}},r.handleOk=function(){var e=r.state.friendsWillBeInvited,t=r.props,n=t.user,a=t.currentChat,o=t.inviteToGroup,c=t.broadcast,s=t.moveChatToTop;o(n,e,a),s(n,a),r.setState({showFriendsModal:!1}),c()},r.handleCancel=function(){r.setState({friendsWillBeInvited:[],showFriendsModal:!1})},r.tryCreateGroup=function(){var e=r.props,t=e.createGroup,n=e.user,a=e.switchChat,o=e.currentChat,c=e.groupNum,s=e.broadcast,u=o.split("-").find(function(e){return e!==n});t(n,u),a(n,"group".concat(c+1)),s()},r.theExtraBtn=function(){var e=r.props.currentChat;return e&&e.includes("group")?a.a.createElement(F.a,{type:"primary",onClick:function(){r.setState({showFriendsModal:!0})}},"Add member"):a.a.createElement(F.a,{type:"primary",onClick:r.tryCreateGroup},"Create group")},r}return Object(C.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.chatContent,n=t.currentChat;return n?a.a.createElement("div",{className:"chat-content"},a.a.createElement(W.a,{title:n,extra:this.theExtraBtn(),className:"the-card"},r.toJS().map(function(t,r){var n=t.name,a=t.msg,o=t.img;return e.createMsgRow({name:n,msg:a,img:o,key:r})})),this.createModal()):null}}]),t}(a.a.Component),U=(r(698),r(210)),P=(r(588),r(294));var z=function(e){var t=e.friends,r=e.user,n=e.switchChat,o=e.currentChat,c=e.chats,s=function(e){return function(){n(r,e)}},u=t.toJS();return a.a.createElement("div",{className:"chat-list"},a.a.createElement(U.a,{bordered:!0,dataSource:u,renderItem:function(e){var t=e,n=e.includes("group");n||(t=r.localeCompare(e)<0?"".concat(r,"-").concat(e):"".concat(e,"-").concat(r));var u=c.get(t)&&c.get(t).last(),i=Object(j.e)(u)?u.toJS():{},m=i.name,l=i.msg;return a.a.createElement(U.a.Item,{onClick:s(e),className:"chat-list-item ".concat(o.includes(e)?"active":"")},a.a.createElement(P.a,{icon:"user",style:{marginRight:"5px"}}),e,a.a.createElement("div",{className:"last-msg"},m&&"".concat(n?m+": ":"").concat(l)))}}))},L=(r(597),r(302)),Q=(r(599),r(212)),Y=(r(700),r(300)),$=(r(604),r(10)),q=function(e){function t(){var e,r;Object(f.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(r=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(o)))).state={msg:""},r.handleInputChange=function(e){var t=e.target.value;r.setState({msg:t})},r.createUploadComponent=function(){var e=r.props,t=e.user,n=e.currentChat,o=e.sendMsg,c=e.broadcast,s=e.moveChatToTop,u={beforeUpload:function(e){if(r.checkFile(e)){var a=new FileReader;return a.readAsDataURL(e),a.onload=function(){o(t,n,"",a.result),s(t,n),c()},!1}},fileList:[]};return a.a.createElement(Y.a,u,a.a.createElement(F.a,{type:"primary",style:{margin:"0.1rem 0 0.1rem 0"}},a.a.createElement($.a,{type:"upload"})," Upload Image"))},r.checkFile=function(e){return"image/jpeg"===e.type||"image/png"===e.type?!!(e.size/1024/1024<2)||(Q.a.error("Image must smaller than 2MB!"),!1):(Q.a.error("You can only upload JPG/PNG file!"),!1)},r}return Object(C.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.user,n=t.currentChat,o=t.sendMsg,c=t.broadcast,s=t.moveChatToTop,u=this.state.msg;return n?a.a.createElement("div",{className:"chat-input"},this.createUploadComponent(),a.a.createElement(L.a,{value:u,onChange:this.handleInputChange,onPressEnter:function(){o(r,n,u),s(r,n),c(),e.setState({msg:""})}})):null}}]),t}(a.a.Component),H=(r(695),J.a.parse(window.location.search,{ignoreQueryPrefix:!0}).user),K=new BroadcastChannel("chat-demo"),V=function(e){function t(){var e,r;Object(f.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).broadcast=function(){setTimeout(function(){var e=r.props.rootData;K.postMessage(JSON.stringify(e))},0)},r}return Object(C.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this;K.onmessage=function(t){var r=JSON.parse(t.data);e.props.actions.syncState(r)}}},{key:"render",value:function(){var e=this.props,t=e.rootData,r=e.actions,n=t.get(H)||Object(j.b)(),o=n.get("friends"),c=n.get("currentChat"),s=t.getIn(["chats",c]),u=t.get("chats"),i=t.get(c),m=t.get("groupNum"),l=r.sendMsg,h=r.retractMsg,p=r.createGroup,d=r.inviteToGroup,f=r.switchChat,g=r.moveChatToTop;return a.a.createElement("div",{className:"home"},a.a.createElement(z,{friends:o,user:H,switchChat:f,currentChat:c,chats:u}),a.a.createElement("div",{className:"chat-body"},a.a.createElement(R,{chatContent:s,user:H,friends:o,currentChat:c,groupMember:i,retractMsg:h,inviteToGroup:d,createGroup:p,switchChat:f,groupNum:m,broadcast:this.broadcast,moveChatToTop:g}),a.a.createElement(q,{user:H,sendMsg:l,currentChat:c,broadcast:this.broadcast,moveChatToTop:g})))}}]),t}(a.a.Component),X=Object(m.b)(function(e){return{rootData:e.home}},function(e){return{actions:Object(y.bindActionCreators)({createUser:E,sendMsg:I,retractMsg:M,createGroup:N,inviteToGroup:T,switchChat:k,syncState:_,moveChatToTop:S},e)}})(V);var Z,ee=r(298),te=r(304),re=r(299),ne={home:G},ae=r(105),oe=Object(ae.a)(),ce=Object(y.createStore)(Object(y.combineReducers)(ne),Z,Object(re.composeWithDevTools)(Object(y.applyMiddleware)(Object(te.a)(),ee.a)));c.a.render(a.a.createElement(m.a,{store:ce},a.a.createElement(l.a,{history:oe},a.a.createElement(h.a,null,a.a.createElement(p.a,{path:"/",component:function(){return a.a.createElement(h.a,null,a.a.createElement(p.a,{component:X,path:"/home"}),a.a.createElement(d.a,{to:"/home?user=user1"}))}})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[308,1,2]]]);